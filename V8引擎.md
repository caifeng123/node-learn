## V8引擎

### 简介

作为后端语言 - java等能够自由分配内存大小，node却有限制

> - 原因在于使用V8引擎，V8引擎有着优秀的垃圾回收机制，但要是内存分配过大则需要更长时间处理垃圾回收，导致js主线程被阻塞过久
> - 因此限制64位操作系统 1.4G,32位操作系统 0.7G



### 垃圾回收

> 所有使用的对象内存分配在堆中

![v8垃圾回收-内存](https://raw.githubusercontent.com/caifeng123/pictures/master/v8%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6-%E5%86%85%E5%AD%98.png)

v8中的内存分为两个部分：

- 新生代 16MB(64位)

  - 由semispace(from)、semispace(to)组成，处于使用状态的空间叫from，闲置的为to

  > scavenge算法：当开始垃圾回收时，会检查from中的对象，当发现对象不存活即被释放，活着的将会被整理好复制进入to中。最后进行from & to区域交换完成一次垃圾回收

- 老生代 1400MB(64位)

  - 从新生代晋升的对象

    - 是否对象经过scavenge回收

    <img style="display: inline-block" src="https://raw.githubusercontent.com/caifeng123/pictures/master/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6%20(3).png" />

    - to空间占比超过25%限制

      （因为to空间在完成scavenge后将会变为from空间，用作接收新的内存，要是占比过高会影响后续空间分配）

    <img style="display: inline-block" src="https://raw.githubusercontent.com/caifeng123/pictures/master/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6%20(4).png" />

  